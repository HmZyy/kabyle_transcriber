(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2141:(e,t,a)=>{Promise.resolve().then(a.bind(a,5066))},5066:(e,t,a)=>{"use strict";a.d(t,{default:()=>es});var r=a(5155),s=a(2115),n=a(2596),i=a(9688);function l(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.QP)((0,n.$)(t))}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:l("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:l("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:l("leading-none font-semibold",t),...a})}function u(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:l("text-muted-foreground text-sm",t),...a})}function m(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:l("px-6",t),...a})}var g=a(9708),x=a(2085);let h=(0,x.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function v(e){let{className:t,variant:a,size:s,asChild:n=!1,...i}=e,o=n?g.DX:"button";return(0,r.jsx)(o,{"data-slot":"button",className:l(h({variant:a,size:s,className:t})),...i})}let p=(0,x.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function f(e){let{className:t,variant:a,asChild:s=!1,...n}=e,i=s?g.DX:"span";return(0,r.jsx)(i,{"data-slot":"badge",className:l(p({variant:a}),t),...n})}var b=a(64);function j(e){let{className:t,...a}=e;return(0,r.jsx)(b.bL,{"data-slot":"tabs",className:l("flex flex-col gap-2",t),...a})}function w(e){let{className:t,...a}=e;return(0,r.jsx)(b.B8,{"data-slot":"tabs-list",className:l("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function y(e){let{className:t,...a}=e;return(0,r.jsx)(b.l9,{"data-slot":"tabs-trigger",className:l("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function N(e){let{className:t,...a}=e;return(0,r.jsx)(b.UC,{"data-slot":"tabs-content",className:l("flex-1 outline-none",t),...a})}function k(e){let{className:t,type:a,...s}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:l("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}var S=a(968);function A(e){let{className:t,...a}=e;return(0,r.jsx)(S.b,{"data-slot":"label",className:l("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}var C=a(9962),M=a(6474),z=a(5196),I=a(7863);function L(e){let{...t}=e;return(0,r.jsx)(C.bL,{"data-slot":"select",...t})}function T(e){let{...t}=e;return(0,r.jsx)(C.WT,{"data-slot":"select-value",...t})}function D(e){let{className:t,size:a="default",children:s,...n}=e;return(0,r.jsxs)(C.l9,{"data-slot":"select-trigger","data-size":a,className:l("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[s,(0,r.jsx)(C.In,{asChild:!0,children:(0,r.jsx)(M.A,{className:"size-4 opacity-50"})})]})}function E(e){let{className:t,children:a,position:s="popper",...n}=e;return(0,r.jsx)(C.ZL,{children:(0,r.jsxs)(C.UC,{"data-slot":"select-content",className:l("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[(0,r.jsx)(U,{}),(0,r.jsx)(C.LM,{className:l("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,r.jsx)(R,{})]})})}function _(e){let{className:t,children:a,...s}=e;return(0,r.jsxs)(C.q7,{"data-slot":"select-item",className:l("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(C.VF,{children:(0,r.jsx)(z.A,{className:"size-4"})})}),(0,r.jsx)(C.p4,{children:a})]})}function U(e){let{className:t,...a}=e;return(0,r.jsx)(C.PP,{"data-slot":"select-scroll-up-button",className:l("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(I.A,{className:"size-4"})})}function R(e){let{className:t,...a}=e;return(0,r.jsx)(C.wn,{"data-slot":"select-scroll-down-button",className:l("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(M.A,{className:"size-4"})})}var F=a(5863);function P(e){let{className:t,value:a,...s}=e;return(0,r.jsx)(F.bL,{"data-slot":"progress",className:l("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",t),...s,children:(0,r.jsx)(F.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}var O=a(7655);function q(e){let{className:t,children:a,...s}=e;return(0,r.jsxs)(O.bL,{"data-slot":"scroll-area",className:l("relative",t),...s,children:[(0,r.jsx)(O.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,r.jsx)(W,{}),(0,r.jsx)(O.OK,{})]})}function W(e){let{className:t,orientation:a="vertical",...s}=e;return(0,r.jsx)(O.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:l("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...s,children:(0,r.jsx)(O.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}let G=(0,x.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function B(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:l(G({variant:a}),t),...s})}function H(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-description",className:l("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}var V=a(6517),J=a(9397),K=a(5339),X=a(4449),Q=a(9588),Y=a(6767),Z=a(381),$=a(8979),ee=a(646),et=a(5273),ea=a(2525),er=a(4186);function es(){var e;let[t,a]=(0,s.useState)(null),[n,i]=(0,s.useState)("disconnected"),[l,g]=(0,s.useState)(""),[x,h]=(0,s.useState)(!1),[p,b]=(0,s.useState)(0),[S,C]=(0,s.useState)(0),[M,z]=(0,s.useState)(!1),[I,U]=(0,s.useState)(!1),[R,F]=(0,s.useState)(!1),[O,W]=(0,s.useState)(!1),[G,es]=(0,s.useState)(()=>localStorage.getItem("kabyle-transcriber-ws-url")||"ws://localhost:8765"),[en,ei]=(0,s.useState)(()=>Number(localStorage.getItem("kabyle-transcriber-chunk-duration"))||3),[el,eo]=(0,s.useState)(()=>localStorage.getItem("kabyle-transcriber-audio-quality")||"64000"),[ec,ed]=(0,s.useState)([]),[eu,em]=(0,s.useState)([]),eg=(0,s.useRef)(null),ex=(0,s.useRef)(null),eh=(0,s.useRef)(null),ev=(0,s.useRef)(null),ep=(0,s.useRef)(null),ef=(0,s.useRef)(null),eb=(0,s.useRef)(null),ej=(0,s.useRef)(null),ew=(0,s.useRef)(0),ey=(0,s.useRef)(null),eN=(0,s.useRef)(0);(0,s.useEffect)(()=>{(()=>{let e=navigator.userAgent||navigator.vendor||window.opera,t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase());U(t),ek("Device detected: ".concat(t?"Mobile":"Desktop"))})()},[]),(0,s.useEffect)(()=>{let e=()=>{document.hidden?(ek("App went to background"),x&&(ek("Stopping recording due to background"),eI())):(ek("App returned to foreground"),eh.current&&"suspended"===eh.current.state&&eh.current.resume().then(()=>{}).catch(e=>{ek("Failed to resume audio context: "+e.message)}))};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[x]),(0,s.useEffect)(()=>{let e=e=>{e.touches.length>1&&e.preventDefault()},t=e=>{let t=Date.now();t-eN.current<300&&e.preventDefault(),eN.current=t};return document.addEventListener("touchstart",e,{passive:!1}),document.addEventListener("touchstart",t,{passive:!1}),()=>{document.removeEventListener("touchstart",e),document.removeEventListener("touchstart",t)}},[]),(0,s.useEffect)(()=>{localStorage.setItem("kabyle-transcriber-ws-url",G)},[G]),(0,s.useEffect)(()=>{localStorage.setItem("kabyle-transcriber-chunk-duration",en.toString())},[en]),(0,s.useEffect)(()=>{localStorage.setItem("kabyle-transcriber-audio-quality",el)},[el]);let ek=(0,s.useCallback)(e=>{let t=new Date().toLocaleTimeString();em(a=>[...a.slice(-49),"[".concat(t,"] ").concat(e)])},[]),eS=(0,s.useCallback)(e=>{let{type:t}=e;if("state"===t)"recording"!==e.state&&g(e.message||""),ek("State: ".concat(e.state," - ").concat(e.message));else if("transcription"===t){let t={id:e.audio_id||"transcription_".concat(Date.now()),text:e.transcription||"",timestamp:new Date(e.timestamp||Date.now()),audioId:e.audio_id||"unknown",isLive:!0};ed(e=>[...e.slice(-19),t]),ek("Live transcription: ".concat(e.transcription))}else"error"===t?(ek("Error: ".concat(e.message," (").concat(e.code||"unknown",")")),x||(i("error"),g(e.message||"Unknown error"))):ek("Unknown message type: ".concat(t))},[ek,x]),eA=(0,s.useCallback)(async()=>{try{let e;if("https:"!==location.protocol&&"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname&&(ek("⚠️ WARNING: getUserMedia requires HTTPS on most mobile browsers"),ek("Current: ".concat(location.protocol,"//").concat(location.hostname))),I&&"permissions"in navigator)try{let e=await navigator.permissions.query({name:"microphone"});ek("Microphone permission status: ".concat(e.state))}catch(e){ek("Could not query microphone permission: "+e)}let t={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3,channelCount:1,...I&&{latency:0,volume:1}},video:!1};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{e=await navigator.mediaDevices.getUserMedia(t)}catch(e){ek("❌ Modern API failed: "+e.message)}if(!e){for(let{name:a,method:r}of[{name:"webkitGetUserMedia",method:navigator.webkitGetUserMedia},{name:"getUserMedia",method:navigator.getUserMedia},{name:"mozGetUserMedia",method:navigator.mozGetUserMedia},{name:"msGetUserMedia",method:navigator.msGetUserMedia}])if(r&&!e)try{e=await new Promise((e,s)=>{r.call(navigator,t,t=>{e(t)},e=>{ek("❌ Legacy ".concat(a," failed: ").concat(e.message||e)),s(e)})});break}catch(e){continue}}if(!e)throw Error("All getUserMedia methods failed. This browser may not support microphone access or requires HTTPS.");ex.current=e,F(!0);let a=e.getAudioTracks()[0];if(a){let e=a.getSettings();ek("Audio track settings: ".concat(JSON.stringify(e)))}let r=window.AudioContext||window.webkitAudioContext;if(!r)return W(!0),!0;try{let t=new r({sampleRate:16e3,latencyHint:"interactive"});"suspended"===t.state&&(await t.resume(),ek("Audio context resumed during initialization"));let a=t.createAnalyser(),s=t.createMediaStreamSource(e);a.fftSize=512,a.smoothingTimeConstant=.8,a.minDecibels=-90,a.maxDecibels=-10,s.connect(a),eh.current=t,ev.current=a,ek("Audio context and analyser initialized successfully")}catch(e){ek("Audio context failed, continuing without visualization: "+e.message)}return W(!0),!0}catch(t){let e=t.message;return I&&(e.includes("Permission denied")||e.includes("NotAllowedError")?alert("❌ Microphone permission denied!\n\nTo fix this:\n1. Refresh the page\n2. When prompted, click 'Allow' for microphone\n3. Check your browser's site settings"):e.includes("NotFoundError")||e.includes("DeviceNotFoundError")?alert("❌ No microphone found!\n\nPlease check:\n1. Your device has a working microphone\n2. No other apps are using the microphone\n3. Try restarting your browser"):e.includes("NotSupportedError")?alert("❌ Microphone not supported!\n\nTry:\n1. Updating your browser\n2. Using Chrome, Safari, or Firefox\n3. Checking if your device supports web microphone access"):e.includes("HTTPS")||"https:"!==location.protocol?alert("❌ HTTPS Required!\n\nMicrophone access requires a secure connection.\n\nTry:\n1. Using https:// instead of http://\n2. Testing on localhost for development\n3. Using a secure hosting service"):alert("❌ Microphone access failed!\n\nError: "+e+"\n\nTroubleshooting:\n1. Refresh the page\n2. Try a different browser\n3. Check browser permissions\n4. Ensure microphone isn't used by another app")),F(!1),W(!1),console.error("Audio initialization error:",t),!1}},[ek,I]),eC=(0,s.useCallback)(()=>{var e;let t=(null===(e=eg.current)||void 0===e?void 0:e.state)==="recording";if(!ev.current||!t){ej.current&&(cancelAnimationFrame(ej.current),ej.current=null),C(0);return}try{let e=ev.current.fftSize,t=new Uint8Array(e);ev.current.getByteTimeDomainData(t);let a=0;for(let r=0;r<e;r++){let e=(t[r]-128)/128;a+=e*e}let r=Math.sqrt(a/e),s=Math.min(100,500*r);C(s)}catch(e){console.error("Audio level calculation error:",e),C(0)}ej.current=requestAnimationFrame(eC)},[x,ek]),eM=(0,s.useCallback)(e=>{let t=ey.current;if(!t||t.readyState!==WebSocket.OPEN){ek("Cannot send audio: WebSocket not connected");return}ew.current++;let a=new FileReader;a.onload=a=>{try{var r;let s=null===(r=a.target)||void 0===r?void 0:r.result;if(!s){ek("Error: Failed to read audio data");return}let n=s.split(",")[1];if(!n){ek("Error: Invalid audio data format");return}let i={type:"audio",audio_data:n,format:"base64",audio_id:"mobile_chunk_".concat(Date.now(),"_").concat(ew.current),timestamp:new Date().toISOString()};t.readyState===WebSocket.OPEN&&(t.send(JSON.stringify(i)),ek("Sent audio chunk ".concat(ew.current," (").concat((e.size/1024).toFixed(1)," KB)")))}catch(e){ek("Error sending audio chunk: "+e.message)}},a.onerror=e=>{ek("Error reading audio blob: "+e.message)},a.readAsDataURL(e)},[ek]),ez=(0,s.useCallback)(async()=>{if(ek("Attempting to start recording..."),(!O||!ex.current)&&!await eA()){ek("Failed to initialize audio");return}if(!ex.current){ek("No audio stream available");return}try{if(eh.current&&"suspended"===eh.current.state&&await eh.current.resume(),ev.current){let e=new Uint8Array(ev.current.fftSize);ev.current.getByteTimeDomainData(e),e.some(e=>128!==e)}let e="audio/webm;codecs=opus";for(let t of["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/wav","audio/ogg;codecs=opus"])if(MediaRecorder.isTypeSupported(t)){e=t,ek("Using MIME type: ".concat(t));break}let t={mimeType:e||void 0,audioBitsPerSecond:Number.parseInt(el)},a=new MediaRecorder(ex.current,t),r=[];a.ondataavailable=e=>{e.data.size>0&&(r.push(e.data),ek("Audio chunk received: ".concat(e.data.size," bytes")))},a.onstop=()=>{if(r.length>0){let t=new Blob(r,{type:e});eM(t),r=[]}},a.onerror=e=>{var t;ek("MediaRecorder error: "+(null===(t=e.error)||void 0===t?void 0:t.message))},a.start(),eg.current=a;let s=I?Math.max(1,en-.5):en;ef.current=setInterval(()=>{"recording"===a.state&&(a.stop(),a.start())},1e3*s),h(!0),b(0),ew.current=0,ep.current=setInterval(()=>{b(e=>e+.1)},100),setTimeout(()=>{eC()},50),ep.backupLevelInterval=setInterval(()=>{var e;if((null===(e=eg.current)||void 0===e?void 0:e.state)==="recording"){if(ev.current)try{let e=new Uint8Array(ev.current.fftSize);ev.current.getByteTimeDomainData(e);let t=0;for(let a=0;a<e.length;a++){let r=Math.abs(e[a]-128);t+=r}let a=t/e.length,r=Math.min(100,a/128*300);C(r)}catch(e){ek("❌ Backup audio level failed: "+e.message)}else{let e=20+30*Math.random(),t=15*Math.sin(Date.now()/200),a=.1>Math.random()?40*Math.random():0,r=Math.max(0,Math.min(100,e+t+a));C(r)}}},500)}catch(e){ek("Error starting recording: "+e.message)}},[el,en,eA,eM,eC,ek,O,I,x]),eI=(0,s.useCallback)(()=>{var e;(null===(e=eg.current)||void 0===e?void 0:e.state)==="recording"&&eg.current.stop(),ef.current&&(clearInterval(ef.current),ef.current=null),ep.current&&(clearInterval(ep.current),ep.current=null),ep.backupLevelInterval&&(clearInterval(ep.backupLevelInterval),ep.backupLevelInterval=null),ep.simulatedLevelInterval&&(clearInterval(ep.simulatedLevelInterval),ep.simulatedLevelInterval=null),ej.current&&(cancelAnimationFrame(ej.current),ej.current=null),h(!1),b(0),C(0)},[ek]),eL=(0,s.useCallback)(()=>{let e=ey.current;if((null==e?void 0:e.readyState)!==WebSocket.OPEN){i("connecting"),g("Connecting to server..."),ek("Connecting to ".concat(G,"..."));try{let e=new WebSocket(G);e.binaryType="arraybuffer",e.onopen=t=>{i("connected"),g("Connected"),ek("Connected to server successfully"),a(e),ey.current=e,eb.current&&(clearTimeout(eb.current),eb.current=null),e.send(JSON.stringify({type:"device_info",is_mobile:I,user_agent:navigator.userAgent,timestamp:new Date().toISOString()}))},e.onmessage=e=>{try{let t=JSON.parse(e.data);eS(t)}catch(e){ek("Error parsing message: "+e.message)}},e.onclose=e=>{let t=e.reason||"Unknown reason",r=e.code||"Unknown code";if(i("disconnected"),g("Disconnected (".concat(r,")")),ek("Disconnected from server - Code: ".concat(r,", Reason: ").concat(t)),a(null),ey.current=null,x&&eI(),1e3!==e.code&&!eb.current){let e=I?1e3:3e3;eb.current=setTimeout(()=>{ek("Attempting to reconnect..."),eL()},e)}},e.onerror=e=>{i("error"),g("Connection failed"),ek("WebSocket error occurred")}}catch(e){i("error"),g("Failed to create connection"),ek("Error creating WebSocket: "+e.message)}}},[ek,eS,x,eI,G,I]),eT=(0,s.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),"connected"===n&&!x){if(I&&"vibrate"in navigator&&navigator.vibrate(50),z(!0),eh.current&&"suspended"===eh.current.state)try{await eh.current.resume()}catch(e){ek("Failed to resume audio context: "+e.message)}await ez()}},[n,x,ez,ek,I]),eD=(0,s.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),z(!1),x&&eI(),I&&"vibrate"in navigator&&navigator.vibrate(25)},[x,eI,ek,I]),eE=(0,s.useCallback)(()=>{ed([])},[]),e_=(0,s.useCallback)(()=>{em([])},[]),eU=(0,s.useCallback)(()=>{eb.current&&(clearTimeout(eb.current),eb.current=null);let e=ey.current;e&&(e.close(1e3,"Manual disconnect"),a(null),ey.current=null),x&&eI(),i("disconnected"),g("Manually disconnected"),ek("Manually disconnected from server")},[x,eI,ek]);return(0,s.useEffect)(()=>()=>{eb.current&&clearTimeout(eb.current);let e=ey.current;e&&e.close(1e3,"Component unmounting"),ex.current&&ex.current.getTracks().forEach(e=>e.stop()),eh.current&&"closed"!==eh.current.state&&eh.current.close(),ef.current&&clearInterval(ef.current),ep.current&&clearInterval(ep.current),ep.backupLevelInterval&&clearInterval(ep.backupLevelInterval),ep.simulatedLevelInterval&&clearInterval(ep.simulatedLevelInterval),ej.current&&cancelAnimationFrame(ej.current)},[]),(0,r.jsx)("div",{className:"min-h-screen bg-slate-900 p-4 md:p-8",children:(0,r.jsxs)("div",{className:"mx-auto max-w-4xl space-y-6",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,r.jsx)(Q.A,{className:"h-8 w-8 text-blue-500"}),(0,r.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-slate-100",children:"Kabyle Transcriber"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[(0,r.jsxs)(f,{variant:"default",className:"flex items-center gap-1",children:[(()=>{switch(n){case"connected":return(0,r.jsx)(V.A,{className:"h-4 w-4"});case"connecting":return(0,r.jsx)(J.A,{className:"h-4 w-4 animate-pulse"});case"error":return(0,r.jsx)(K.A,{className:"h-4 w-4"});default:return(0,r.jsx)(X.A,{className:"h-4 w-4"})}})(),"connected"===n?"Connected":"connecting"===n?"Connecting":"error"===n?"Error":"Disconnected"]}),I&&(0,r.jsxs)(f,{variant:"secondary",className:"flex items-center gap-1",children:[(0,r.jsx)(Y.A,{className:"h-3 w-3"}),"Mobile"]}),l&&(0,r.jsx)("p",{className:"text-sm text-slate-400",children:l})]})]}),(0,r.jsxs)(j,{defaultValue:"main",className:"w-full",children:[(0,r.jsxs)(w,{className:"grid w-full grid-cols-2",children:[(0,r.jsxs)(y,{value:"main",className:"flex items-center gap-2",children:[(0,r.jsx)(Q.A,{className:"h-4 w-4"}),"Main"]}),(0,r.jsxs)(y,{value:"settings",className:"flex items-center gap-2",children:[(0,r.jsx)(Z.A,{className:"h-4 w-4"}),"Settings"]})]}),(0,r.jsxs)(N,{value:"main",className:"space-y-6",children:[(0,r.jsxs)(o,{className:"bg-slate-800 border-slate-700",children:[(0,r.jsxs)(c,{children:[(0,r.jsx)(d,{className:"text-center text-slate-100",children:"Push to Talk"}),(0,r.jsx)(u,{className:"text-center text-slate-400",children:"connected"===n?I?"Tap and hold the microphone button to record":"Hold the microphone button to record":"Connect to server to start recording"})]}),(0,r.jsxs)(m,{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(v,{size:"lg",variant:x||M?"destructive":"default",className:"h-24 w-24 md:h-32 md:w-32 rounded-full transition-all duration-200 ".concat(x||M?"scale-105 shadow-lg shadow-red-500/25":"hover:scale-105 bg-blue-600 hover:bg-blue-700"," ").concat("connected"!==n?"opacity-50":""),disabled:"connected"!==n,onMouseDown:eT,onMouseUp:eD,onMouseLeave:eD,onTouchStart:eT,onTouchEnd:eD,onTouchCancel:eD,children:x?(0,r.jsx)($.A,{className:"h-8 w-8 md:h-12 md:w-12"}):(0,r.jsx)(Q.A,{className:"h-8 w-8 md:h-12 md:w-12"})})}),!R&&!O&&(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)(v,{onClick:e=>{e.preventDefault(),eA()},className:"min-h-[44px] bg-emerald-600 hover:bg-emerald-700",children:[(0,r.jsx)(ee.A,{className:"h-4 w-4 mr-2"}),"Grant Microphone Permission"]})}),x&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl md:text-3xl font-mono font-bold text-red-500",children:(e=>{let t=Math.floor(e/60),a=Math.floor(e%60);return"".concat(t.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"))})(p)}),(0,r.jsx)("p",{className:"text-sm text-slate-400",children:"Recording time"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,r.jsx)(et.A,{className:"h-4 w-4 text-slate-400"}),(0,r.jsx)("span",{className:"text-sm text-slate-400",children:"Audio Level"})]}),(0,r.jsx)(P,{value:Math.min(100,S),className:"w-full"})]})]})]})]}),(0,r.jsxs)(o,{className:"bg-slate-800 border-slate-700",children:[(0,r.jsxs)(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d,{className:"text-slate-100",children:"Transcriptions"}),(0,r.jsxs)(v,{variant:"outline",size:"sm",onClick:eE,className:"flex items-center gap-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent",children:[(0,r.jsx)(ea.A,{className:"h-4 w-4"}),!I&&"Clear"]})]}),(0,r.jsx)(m,{children:(0,r.jsx)(q,{className:"h-64 md:h-96 w-full",children:0===ec.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-slate-400",children:[(0,r.jsx)(Q.A,{className:"h-12 w-12 mb-4 opacity-50"}),(0,r.jsx)("p",{children:"No transcriptions yet."}),(0,r.jsxs)("p",{className:"text-sm",children:[I?"Tap and hold":"Hold"," the microphone button to record."]})]}):(0,r.jsx)("div",{className:"space-y-4",children:ec.map(e=>(0,r.jsxs)("div",{className:"p-4 rounded-lg border-l-4 bg-slate-700/50 ".concat(e.isLive?"border-l-yellow-500":"border-l-blue-500"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)(f,{variant:e.isLive?"destructive":"default",className:"text-xs",children:e.isLive?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.A,{className:"h-3 w-3 mr-1"}),"Live"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ee.A,{className:"h-3 w-3 mr-1"}),"Final"]})}),(0,r.jsxs)("span",{className:"text-xs text-slate-400 flex items-center gap-1",children:[(0,r.jsx)(er.A,{className:"h-3 w-3"}),e.timestamp.toLocaleString()]})]}),(0,r.jsx)("p",{className:"text-sm md:text-base leading-relaxed text-slate-200",children:e.text||(0,r.jsx)("em",{className:"text-slate-400",children:"No transcription"})}),(0,r.jsxs)("div",{className:"text-xs text-slate-500 mt-2 truncate",children:["Audio ID: ",e.audioId]})]},e.id))})})})]})]}),(0,r.jsxs)(N,{value:"settings",className:"space-y-6",children:[(0,r.jsxs)(o,{className:"bg-slate-800 border-slate-700",children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{className:"text-slate-100",children:"Connection Settings"})}),(0,r.jsxs)(m,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(A,{htmlFor:"ws-url",className:"text-slate-200",children:"WebSocket URL"}),(0,r.jsx)(k,{id:"ws-url",type:"text",value:G,onChange:e=>es(e.target.value),placeholder:"ws://localhost:8765",disabled:"connecting"===n,className:"bg-slate-700 border-slate-600 text-slate-100 placeholder:text-slate-400"})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:["connected"===n?(0,r.jsxs)(v,{onClick:eU,variant:"destructive",className:"flex-1",children:[(0,r.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"Disconnect"]}):(0,r.jsxs)(v,{onClick:eL,disabled:"connecting"===n,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[(0,r.jsx)(V.A,{className:"h-4 w-4 mr-2"}),"connecting"===n?"Connecting...":"Connect"]}),(0,r.jsxs)(v,{variant:"outline",onClick:()=>{let e=ey.current;e&&e.readyState===WebSocket.OPEN?(e.send(JSON.stringify({type:"ping",timestamp:new Date().toISOString()})),ek("Ping sent to server")):ek("Cannot ping: not connected to server")},disabled:"connected"!==n,className:"border-slate-600 text-slate-300 hover:bg-slate-700",children:[(0,r.jsx)(J.A,{className:"h-4 w-4 mr-2"}),"Ping"]})]})]})]}),(0,r.jsxs)(o,{className:"bg-slate-800 border-slate-700",children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{className:"text-slate-100",children:"Audio Settings"})}),(0,r.jsxs)(m,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(A,{htmlFor:"chunk-duration",className:"text-slate-200",children:"Chunk Duration (seconds)"}),(0,r.jsx)(k,{id:"chunk-duration",type:"number",min:"1",max:"10",value:en,onChange:e=>ei(Number.parseInt(e.target.value)),className:"bg-slate-700 border-slate-600 text-slate-100"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(A,{htmlFor:"audio-quality",className:"text-slate-200",children:"Audio Quality"}),(0,r.jsxs)(L,{value:el,onValueChange:eo,children:[(0,r.jsx)(D,{id:"audio-quality",className:"bg-slate-700 border-slate-600 text-slate-100",children:(0,r.jsx)(T,{})}),(0,r.jsxs)(E,{className:"bg-slate-800 border-slate-700",children:[(0,r.jsx)(_,{value:"96000",className:"text-slate-100 focus:bg-slate-700",children:"High (96 kbps)"}),(0,r.jsx)(_,{value:"64000",className:"text-slate-100 focus:bg-slate-700",children:"Medium (64 kbps)"}),(0,r.jsx)(_,{value:"32000",className:"text-slate-100 focus:bg-slate-700",children:"Low (32 kbps)"})]})]})]})]}),I&&(0,r.jsxs)(B,{className:"bg-slate-700 border-slate-600",children:[(0,r.jsx)(Y.A,{className:"h-4 w-4 text-blue-500"}),(0,r.jsx)(H,{className:"text-slate-200",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-medium",children:"Mobile Audio Status"}),(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("div",{children:["Permission granted:"," ",R?"✅":"❌"]}),(0,r.jsxs)("div",{children:["Audio initialized: ",O?"✅":"❌"]}),(0,r.jsxs)("div",{children:["Audio context state:"," ",(null===(e=eh.current)||void 0===e?void 0:e.state)||"Not created"]})]})]})})]})]})]}),(0,r.jsxs)(o,{className:"bg-slate-800 border-slate-700",children:[(0,r.jsxs)(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(d,{className:"text-slate-100",children:"System Logs"}),(0,r.jsxs)(v,{variant:"outline",size:"sm",onClick:e_,className:"flex items-center gap-1 border-slate-600 text-slate-300 hover:bg-slate-700 bg-transparent",children:[(0,r.jsx)(ea.A,{className:"h-4 w-4"}),!I&&"Clear"]})]}),(0,r.jsx)(m,{children:(0,r.jsx)(q,{className:"h-48 md:h-64 w-full",children:(0,r.jsx)("div",{className:"font-mono text-xs space-y-1 p-3 bg-slate-900 rounded-md border border-slate-700",children:0===eu.length?(0,r.jsx)("div",{className:"text-slate-500",children:"No logs yet..."}):eu.map((e,t)=>(0,r.jsx)("div",{className:"text-slate-300 break-words",children:e},t))})})})]})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[162,441,684,358],()=>t(2141)),_N_E=e.O()}]);